
#  Biodiversity collapse in a spatial phase transition between neutral and niche communities

**Leonardo A. Saravia** ^1^ ^2^, **Fernando R. Momo** ^1^ 

1. Instituto de Ciencias 

	Universidad Nacional de General Sarmiento

	J.M. Gutierrez 1159 (1613), Los Polvorines

	Buenos Aires, Argentina.

2. E-mail: <lsaravia@ungs.edu.ar>


## Abstract

The dynamics of ecological communities can be described by two contrasting models: the first assumes that individuals of all species are identical and do not have interactions. The second assumes that species are different, adapted to particular habitat conditions, and have strong interactions. It is known that a critical transition exist between these two states, but the spatial aspect of this transition has not been studied. Here we study the simplest model of neutral-niche communities in a spatially explicit way using a stochastic cellular automata. The neutral model follows the Hubbell's original formulation and niche dynamics is represented as a competitive hierarchy. The competition intensity is defined as a parameter that modulates the transition between these extremes. We use the theory of percolation to study the geometric properties of species patches. The transition is signed by the apparition of a large patch that connects the whole area, the properties of this patch can be used as an early warning signals: the proportion of the largest patch with respect to the total area covered by the species, variance of the size fluctuations and the skewness of the fluctuations distribution. These three indices can be combined to show that a critical transition is approaching. The model shows that at the critical point there is a sudden fall of species diversity but the richness shows a gentle decline with increasing competitive intensity. The critical point occurs at a very low value of competitive intensity and the rate of migration from the metacommunity greatly influences the position of the critical point. As an example we apply the early warnings to the Barro Colorado Tropical forest, which as expected, appear to be far from a critical transition. Low values of competitive intensity were also reported for different high diversity real communities suggesting the possibility that these kind of communities are located before the critical point. A small increase of competitive interactions could bring them to the other side where diversity is much lower. This transition could happen before habitat destruction or degradation affect the community in response to changes in environmental conditions like the ones produced by climate change or exotic species invasions. 

*Short title:* A spatial phase transition between neutral and niche communities

*keywords:* Continuous critical transitions; Percolation; Neutral-niche communities; spatial stochastic models; Biodiversity collapse 



\newpage

## Introduction

Much effort has been devoted to understanding the mechanisms of community assembly and dynamics. Classical studies emphasized on deterministic processes based on niche differences between species; the niche theory assumes that different species are regulated by different environmental factors and infer that diversity originates from spatial and temporal environmental heterogeneity [@Tilman1982; @Chesson2000]. More recently, the emphasis shifted to stochastic mechanisms in the form of the Neutral Theory of Biodiversity and Biogeography [@Hubbell2001]. The neutral theory assumes that individuals of all species are equivalent and it proposes that diversity originates from a balance between immigration, speciation, and extinction. The neutral theory has been proposed as a parsimonious formulation that can provide new insight into the patterns of community assembly [@Hubbell2005], besides this simplification it can predict some community metrics very well [@Volkov2007; @Rosindell2012], mainly the species abundance distribution (SAD).

The neutral theory has generated a great deal of controversy [@Clark2012a,@Chave2004], one way to resolve this is to understand which species level traits are important for community dynamics at different spatial scales [@Matthews2014]. The assumption of the neutral theory is that differences in specific traits are not essential to predict community patterns at larger scales [@Chave2004]. Finally a unified view has arisen that accepts that both kinds of mechanisms are present at the same time and the focus shifted to quantifying the relative importance of these in natural communities [@Kalyuzhny2014;@Martorell2014; @Vergnon2009; @Jabot2011; @Gravel2006; @Zhou2008].  

The problems of pattern and scale are critical in ecology [@Levin1992; @Chave2013], because patterns that seem stochastic at one scale may reveal structure at another scale. The concept of pattern is related to some sort of repetition that our brain can detect, when this pattern repeats at different scales we talk about scale invariance or self-similarity, characterized by power laws. These patterns could be produced by critical phase transitions described by percolation theory [@Stauffer1994]. This kind of spatial phase transitions were first introduced in ecology in the framework of landscape ecology [@Loehle1996b] and habitat fragmentation [@Bascompte1996]. 

Percolation is characterized by the presence of two phases defined by some macroscopic features, e.g. the presence of vegetation or a desert in arid ecosystems [@Kefi2007b]. These phases are linked by a critical point were a sudden transition happens and a large spatial pattern emerges. In a two dimensional landscape where each site is connected to the nearest neighbors with some probability $p$, if you start with a small $p$ there will be some connected sites that form a cluster or patch. When $p$ increases, there is a point at which appears a cluster of sites spanning the entire landscape. This spanning cluster has a self-similar structure and is produced by local interactions [@Sole2006]. 

Several different ecological spatial models exhibit critical behavior related to the degree of disturbance [@Pascual2005a]. Some of these models showed robust criticality: a particular kind of criticality discovered for ecological systems, where self-similarity is present for a wide range of parameters and does not necessarily involve drastic changes in the biological variables of interest [@Roy2003]. This kind of criticality has been documented for arid ecosystems [@Sole2007]; here the sudden shift towards a desert condition might occur when rainfall decreases [@Scanlon2007] or also with more intense grazing [@Kefi2007b]. The mechanism producing self-similarity is the positive effect produced by local facilitation, the chance of a new seedling to become established is higher near the parent plant.

Another example of an ecosystem exhibiting criticality are savannas, where the transition occurs between tree and grass cover [@Abades2014]. In critical phenomena, the transition is produced by the capacity of the system to transmit some signal or information, for example in savannas the proportion of 60% grass 40% trees is linked to the threshold needed for fire to spread. If there is not enough grass to act as a combustible, fire can not spread across the landscape [@Staver2012]. Thus the increase in the proportion of trees, due to a change in environmental conditions, can create positive feedback mechanisms resulting in the encroachment of savanna ecosystems [@Abades2014].  

Neutral models can produce species patches with power law distributions without been near a critical state [@Houchmandzadeh2003], so the detection of this kind of patterns does not imply a phase transition. Moreover sudden changes between neutral and niche dynamics were described for non-spatial models [@Chisholm2011; @Zhou2008; Kalyuzhny2014] and Fisher et al. [-@Fisher2014] demonstrated the presence of a phase transition for this kind of neutral-niche models.

Here we study the phase transition between neutral and niche dynamics from a spatial point of view, this transition could produce a drastic reduction on diversity that is not related to disturbance. We used the simplest model of neutral-niche communities where niche dynamics is represented as a competitive hierarchy [@Saravia2015a]. This spatially explicit model unifies Tilman's model of hierarchical competition with the classical neutral model using one parameter: competition intensity. This parameter is represented as the probability that one species replaces another and it modulates the transition between the neutral phase and niche phase. 

Our first aim is to demonstrate the existence of the phase transition in a spatial neutral-niche model, we would like  to show that the phase transition is determined by the geometric characteristics of the species patches and this produces a drastic reduction in diversity. We also analyze the changes in the value of the critical point as an indication of the sensitivity of different communities to changes on the competion intensity. Then our second objective is to present some early warnings based on the dynamics of patches. Finally we will apply this new kind of early warnings to the repeated censuses of the Barro Colorado Island 50-ha forest plot in Panama (BCI).


# Methods

First, we define the spatial explicit neutral-hierarchical model, then we explain how we characterized its critical behavior in terms of percolation theory and how simulations are performed. We analyze early warnings for this critical transition and apply the same techniques for BCI plot data. We refer to interested readers to more extensive introductions to percolation theory in an ecological context [@Sole2006; @Oborny2007]. 

## The spatial stochastic model

This model represents a continuum between hierarchical and neutral model in the same spirit as @Gravel2006, and others [@Chisholm2010;@Zhou2008]. The model is a stochastic cellular automata (CA) or also called an interactive particle system [@Durrett1994a]. In these kind of models space is discretized into a grid and only one individual can occupy a particular position. Each position represents an area fixed by the investigator to mimic the real system. Time is continuous so the update of the model is asynchronous. Sites are chosen at random to be updated and to perform one complete time interval $J$ sites have to be updated, where $J$ is the size of the grid [@Durrett1994a]. The units of the grid are arbitrary but to use parameters fitted from field studies we chose a side of 1 meter.  

We use periodic boundary conditions, which makes the landscape a torus. It means that sites on the top edge of the grid are neighbors of those on the bottom edge, and sites on the right edge are neighbors of those on the left. With this choice we avoid edge effects, this is equivalent to thinking that the grid is embedded in a large community. The size of the community is given by *J = dimX* x *dimY*, where *dimX* and *dimY* are the dimension of the grid. Thus *J* is the maximum number of individuals in the simulated area. As in a classical neutral model there is a metacommunity i.e. a regional species pool assumed very large and invariant in ecological time scales [@Hubbell2001]. All individuals have the same parameters, unless they should belong to different species [@Hubbell2001], and each species is assigned with a number. There are only two possible differences between species: 

* They may have a different frequency $X_i$ in the metacommunity and also different abundances in the local community.

* Hierarchical competition: species with lower numbers has a probability to replace species with higher numbers as in [@Tilman1994]. Thus a species with number 1 have a probability to replace species with number 2 and greater. The species with number 2 can replace species starting from 3. The probability of replacement ($\rho$) is a parameter, when it is 0 there is no replacement and the model behaves like a neutral model without competitive hierarchy.  

The colonization-competition and other possible trade-offs are not explicitly included in the model. But a colonization-competition trade-off can be established if species numbering is arranged in inverse order to its frequency $X_i$ in the metacommunity. Hence the most competitive species (with number 1) will have the lowest migration rate and the less competitive will have the highest migration rate.  

There are four processes included in the model: death, local dispersal, migration, and competition, after setting initial conditions the following events can happen:

(1) With probability *m* an individual of a species *i* can migrate from the metacommunity at a rate proportional to its frequency $X_i$ in the metacommunity.

(2) When the grid is not full, individuals give birth with rate 1 to a new individual that disperses to the neighborhood with a dispersal kernel, here we use an inverse power kernel [@Marco2011]:

 	$d(x) =  \frac{\alpha -1}{x_{min}} \left(\frac{x}{x_{min}} \right)^{-\alpha}$ with $mean =\frac{\alpha-1}{\alpha-2}x_{min}$ where $\alpha > 1$ and $x \ge x_{min}$. 

	where $d(x)$ is the probability that an individual disperse a distance $x$ from the parent. In all cases we used $x_{min} = 1$.


(3) Individuals die at a rate $\mu$

(4) When an individual dies, it is replaced by a migrant from metacommunity with probability $m$ and with probability $1-m$ by an individual from the neighborhood. The neighborhood is established using the dispersal kernel with average distance $d$. Once the grid is full it stays full, because when an individual dies it is immediately replaced by another. This is called the zero-sum assumption in neutral models. 

(5) If the individual does not die it can be replaced by an individual from the metacommunity or neighborhood as in (4), but an individual of species with number $k$ can replace and individual of a species $k+1$ with probability $\rho$. Thus a hierarchical ordering of species is established. When this probability is zero, the model behavior becomes neutral.

The model was developed using the C++ programing language and its source code is available at <https://github/lasaravia/neutral> and figshare <http://dx.doi.org/10.6084/m9.figshare.969692>. 

## Percolation and simulations

To characterize our model in terms of percolation theory, we need to define an order parameter that depends on an external control or tuning parameter that can be continuously varied. Thus, we defined as tuning parameter the replacement probability $\rho$, and the order parameter as the probability that a patch of one species connects the landscape, this is called the spanning cluster probability $SC_p$.

In our model, percolation is produced when there is at least one patch of one species that spans from one edge of the system to the opposite edge. We calculated the patches for all species using a modified Hoshen–Kopelman cluster labeling algorithm [@Hoshen1976] with a neighborhood defined by the four nearest sites (Von Neumann neighborhood) available at github <https://github.com/lsaravia/Clusters>. The percolation point is defined as the  value of the tuning parameter $\rho$ at which $SC_p$ is 0.5. We used one snapshot of the spatial pattern to make our results more compatible with field studies, hence we measure the patch size distributions after the model reach a steady state between 5000 and 30000 time intervals (as defined above).

The size of the lattice affects the value of the critical point $\rho_c$ at which the transition occurs; in small lattices $SC_p$ is non-zero for values of $\rho$ below the $\rho_c$, because patches that connect the entire lattice appear only by chance. Therefore, in order to obtain an asymptotic estimate for $\rho_c$ we performed a finite size scaling analysis. For this, we run simulations for different lattice sizes (Side = 128, 192, 256) and obtained asymptotic values by regressing $\rho_c$ against $1/Side^2$, the intercept becomes an estimate for a lattice of infinite size ($\rho_c^\infty$)[@Stauffer1994; @Sornette2013]. 

We determined critical points for two different metacommunities: a) One with a logseries species abundance distribution, the most common distribution that fits experimental data [@White2012]. With this metacommunity we included a competition-colonization trade-off by arranging species numbers in inverse order as it's frequency $X_i$ in the metacommunity. b) A uniform species distribution, all species have the same probability to colonize the local community. The parameter $m$ represents a long-distance dispersal event from the metacommunity but it could be interpreted as an speciation parameter [@Rosindell2009]. The values of the $m$ parameter (Table 1) were at least two orders of magnitude higher than realistic speciation rates [@Rosindell2009] as it is not our aim to interpret the results in an evolutionary framework, only to show the influence of different metacommunities. 

The parameters used were compatible with published results in tropical forest but encompass a broader range of communities: the number of species in the metacommunity was between 16 and 320. The mean dispersal distance was between 13-53 meters  [@Anand2010; @Condit2002;]. It was suggested that fat-tail dispersal kernels give more realistic results [@Rosindell2009; @Seri2012] so we used an inverse power law distribution with exponents always greater than two---so the mean exists (Table 1). The parameter $m$ has a range from 0.0001 to 0.01, the spatially explicit parameters do not have the same values than the parameters estimated for the spatial implicit model. We used the formulas from Etienne & Rosindell [-@Etienne2011] to calculate the equivalence of spatial explicit parameters with the neutral theory spatially implicit parameters $\theta$ and $I$ (Appendix table S1).

The parameter $\rho$ is varied across all the range between 0 and 1 to determine the critical point, in the region where we suspect the $\rho_c$ will be located (near 0) the steps were very small (0.0001) and greater (0.1) in the region were we don't expect the $\rho_c$. To calculate the value of $rho_c$ at which $SC_p=0.5$ we interpolate linearly from the  four values of $rho$ that have the nearest values of $SC_p$ to 0.5.

All simulations started with a lattice filled with individuals with the same abundance distribution as the metacommunity. For each parameter combination we performed 50 simulations. Thus, we calculate the $SC_p$ as the number of times we observed a spanning cluster divided by the number of simulations. The analysis of the model output were done in the R statistical statistical language [@RCoreTeam2015] and the scripts are available at github <https://github.com/lsaravia/CriticalTransition> and figshare <http://dx.doi.org/10.6084/m9.figshare.2007537>.

We estimated the critical point in wide range of parameters to test that the transition is not confined to a small region in the parameter space. Besides we also analyze changes in the critical point to give us an idea of the sensitivity of the simulated communities to changes in the intensity of competition. This could be useful to compare the predictions of the model with the behavior of real communities where a change in the  competitive intensity was documented. We analyzed the critical point for infinite lattices ($\rho_c^\infty$) varying three parameters of the model, one at a time: the migration $m$, the dispersal distance and the number of species in the metacommunity. To change the dispersal distance we vary the power exponent of the dispersal kernel $\alpha$ (Table 1). We used as a base the first row of the table, so if we vary $m$, the other parameters are fixed at $\alpha=2.04$ and the metacommunity number of species to 320. To compare the sensitivity of $\rho_c^\infty$ to the parameters we calculated the relative variation $max(variable) - min(variable)/max(variable)$, where $variable$ is replaced by the parameter that is varied or by the values of $\rho_c^\infty$, then we divided the relative variation of $\rho_c^\infty$ by the relative variation of the parameter. 


-------------------------------------------------------
  Side   Metacomm.     $\mu$   $\alpha$        $m$
         No. Species           (mean dist.)       
------- ------------- ------- -------------- ----------  
   128           320     0.2   2.04 (26.6)    0.0001    

   192           64      	     2.08 (13.3)    0.001     

   256           16     	     2.02 (53.3)    0.01      

                                                
-------------------------------------------------------

Table: Parameters values used in the simulations of the neutral-hierarchical model. Side, is the size of the side of the simulation grid. The parameter $\mu$ is the mortality rate; $\alpha$ is exponent of the inverse power law dispersal kernel, between brackets is the mean dispersal distance; and $m$ is the migration from the metacommunity. The units of the simulation grid and dispersal are in meters to make them comparable with field values.


## Communities and early warnings signals

To compare communities change near and far from the $\rho_c$ we measured the species abundance distribution (SAD) and calculated the rank abundance diagrams (RAD). These diagrams are equivalent to cumulative distributions and thus are a robust way to visualize the SAD without losing information [@Etienne2011; @Newman2005]. We also calculated richness ($S$) and the Shannon diversity index ($H$) for each simulation.

At the the critical point there is a species with a large patch that dominates the landscape: the spanning species, at the same time this is the species with the largest patch ($S_{max}$). Before the critical point the system is in a subcritical state, the species with the largest patch could be the spanning species. After the critical point the system is in a supercritical state and most of the landscape is occupied by the spanning species. The fraction of cover of the largest patch ($S_{max}$) could be used as a qualitative index to determine if the system is in a subcritical or supercritical state. The $S_{max}$ is calculated as the size of the largest patch divided by the area of the system; when we are working with a natural systems the total area is not well defined because the boundaries of a natural systems are usually not well defined. Thus instead of using the total area to calculate $S_{max}$ we divided $S_{max}$ by the total area occupied by the species, then represents the proportion of the largest patch with respect to the total area occupied by the same species $RS_{max}$. The $RS_{max}$ is a useful qualitative index that could be used to detect if the system is in a subcritical or supercritical state, but does not tell us if the system is near o far from the critical transition. 

The closeness of the kind of critical transition showed by this model can be evaluated using the temporal fluctuations of $S_{max}$ [@Corrado2014]. We calculate the $S_{max}$ fluctuations around the mean $\Delta S_{max}=S_{max}(t)-\langle S_{max} \rangle$, and $\Delta RS_{max}$ using $RS_{max}$.  The variance of the fluctuations of the largest patch $\Delta S_{max}$ reach a maximum at the critical point but a significant increase occurs well before the system reaches the critical point [@Corrado2014]. In addition, before the critical point the skewness of the distribution of $\Delta S_{max}$ should be negative, implying that fluctuations below the average are more frequent. We calculated the fluctuations using the last 20 points of time series of the same length that the ones used for the estimation of critical point, and we made ten repetitions.

For spatial systems with patch structures another early warning indicator of the transition is the distribution of patch sizes [@Kefi2014]. From percolation theory we expect that the distribution of the species with the largest or spanning patch should be a power law ($f(x)=x^{-\alpha}$) or a power law with exponential cutoff ($f(x)=x^{-\alpha}e^{-\lambda x}$) [@Stauffer1994;@Weerman2012; @Pueyo2011]. Besides that, we already know that the patch size distributions of species in neutral models follow a power law and this corresponds to the subcritical part of our model [@Houchmandzadeh2003; @Campos2013]. Thus the power law distribution of patch sizes should be present from $\rho=0$ to near after the critical point $\rho_c$. As an alternative model we fitted an exponential distribution ($f(x)=e^{-\lambda x}$). Near the critical point we may have a species with a continuous patch that spans all over the area: the spanning species, as is usual in percolation studies we excluded the spanning patch from the estimation [@Stauffer1994]. Before the critical point we may not have a spanning species thus we fitted the patch distribution of the species that has the largest patch.   

We measured the patch size distribution from simulations in a range of $\rho$ from neutral to niche communities, using a smaller set than the ones we used to estimate the critical point: $\rho$={0.0000, 0.0001, 0.0003, 0.0005, 0.0010, 0.01}, the other parameters were from the first row of table 1 and a *Side* of 512 sites. The simulations run up to time 10000 or 20000 and then we collected the patch sizes of all species. In some simulations the spanning cluster occupies a great proportion of the landscape in consequence very few patches remain to estimate a distribution. We only fitted a model when there are at least 20 patches and 5 different patch sizes. 

We fitted the mentioned discrete distributions using maximum likelihood methods [@Clauset2009]. After that we calculated the Akaike information criteria corrected for small samples ($AIC_c$), to select the best model [@Burnham2002; @Burnham2011]. All the analysis were made using the R statistical language [@RCoreTeam2015]. The fitting was made using code provided by Cosma R. Shalizi for the power law with exponential cutoff and the package poweRlaw for the other distributions [@Gillespie2015]. The complete source code for statistical analysis, and the outputs of the model are available at github <https://github.com/lsaravia/CriticalTransition> and figshare <http://dx.doi.org/10.6084/m9.figshare.2007537>.


# results
 
We observed a typical pattern of a second order continuous phase transition (Figure 1) which means that at the critical point $\rho_c$ one species percolates through the lattice: a mono-specific patch spreads from side to side, which is called the spanning patch or spanning cluster. As expected from percolation theory [@Stauffer1994; @Sornette2013] the probability of a spanning cluster ($SC_p$) is greater than 0 for $\rho < \rho_c$ and small lattice sizes, for bigger lattice sizes $SC_p$ is 0 for $\rho < \rho_c$ and jumps quickly to 1 for  $\rho > \rho_c$ and this clearly define the two phases or states of the system. These two phases can be observed analyzing the largest patch relative to the total area $S_{max}$ before the critical point $\rho < \rho_c$ is in the range 0.002-0.15 , and after the critical point $\rho > \rho_c$ is greater than 0.92. The same is observed with the largest patch relative to the total species area $RS_{max}$, that is the range 0.009-0.23 before and greater than 0.96 after the critical point (Appendix Figure S1 and table S2). 

![Probability of Spanning cluster for a spatial neutral/niche model as a function of the intensity of competition $\rho$. The columns represent two different metacommunity types: Logseries, a metacommunity with logseries species abundance distribution (SAD); Uniform, a metacommunity with a uniform SAD. The columns represent the side of the simulation lattice, the total size is $side^2$.  The vertical line is the critical point,  the value for parameter $\rho$ where a phase transition between neutral and niche phases occurs. The critical point was determined as the point where the spanning probability is 0.5, the other parameters used were $m$=0.0001, dispersal distance = 26.66](figs/SpanPvsRepl_T20000_320_side_meta_m0.0001.png)


When the competitive intensity surpasses the critical point, the space left by the spanning species quickly diminish so the Shannon diversity ($H$) collapses,  but some individuals can escape the competitive displacement thus richness ($S$) shows a more gentle fall (Figure 2). We can observe the effect of the competition-colonization trade-off in the logseries metacommunities: before the critical point there is small increase in $H$. This is because in the long term the SAD from a neutral community will match the metacommunity SAD [@Houchmandzadeh2003], thus a small degree of competition lowers the density of colonizers and raises $H$ before the critical point. The effect of the trade-off can be observed also in $S$: logseries communities have in general less species than uniform communities and there is an increase of $S$ before the critical point (Figure 2).

![Shannon diversity index and species richness for a spatial neutral/niche model  as a function of the intensity of competition $\rho$. Columns represent with metacommunity types: Logseries is a metacommunity with logseries species abundance distribution (SAD), and the Uniform metacommunity have a uniform SAD, both with 320 species. Rows represent different Shannon Diversity and richness. Points are independent simulations of the model. The parameter $\rho$ representing the intensity of competition is the control parameter and the vertical green line is the critical point were the phase transition occurs. The leftmost value of $\rho = 0$ has been shifted to allow its representation in a logarithmic axes. Other parameters used were side of the simulation lattice 256 sites, $m$=0.0001, dispersal distance = 26.66.](figs/HSvsRepl_320_side256_meta_m0.0001.png)

The differences between logseries and uniform communities are also observed looking at the RADs (Appendix figure 2). Before the critical point logseries communities have a convex shape reflecting that abundances of species with ranks from 10-30 have a slightly higher frequency than uniform communities. Species with ranks more than 40, which are rares species, have in contrast more frequency in uniform than in logseries communities. After the critical point the curvature is inverted, it is concave, for both kind of communities. The change observed in RADs is more gradual than the observed in $H$ or in the $S_{max}$ and $RS_{max}$.

The critical point is the value of the intensity of competition where the phase transition occurs $\rho_c^\infty$. We observed that in general the transition happened at very low $\rho$ values (Appendix Table 3). That means that low levels of competition are needed to change the phase and sharply decrease diversity, this is observed for both logseries and uniform metacommunities. The values for $\rho_c^\infty$ are very similar for logseries and uniform metacommunities.  

We analyzed how the critical point changes varying model parameters, thus the validity of our findings is restricted to these ranges (Table 1). The migration parameter $m$ had the widest range and the biggest relative influence (0.97) on the critical point $\rho_c^\infty$ (Appendix Table 4). When $m$ is greater there is more influence of the metacommunity on the local community, this lowers the effect of competition intensity and makes the $\rho_c^\infty$ higher (Appendix Table 3). The effect becomes important when $m=0.01$ which results in the biggest $\rho_c^\infty$, approximately 0.006 which is an order of magnitude greater than all the other cases (Appendix Table 3). The number of species in the metacommunity has a strong influence on $\rho_c^\infty$  but only for Logseries metacommunities (0.44), for uniform metacommunities there is almost no change (0.07). 
(TO DISCUSSION??) For higher number of species in Logseries metacommunities we obtained higher $\rho_c^\infty$, this means that when we have less species the effect of competition is stronger, the community changes from the neutral to niche phase earlier. This effect could be diminished in uniform communities because all species have the same effective migration rate and this allows a fast recolonization after competitive displacement. Finally dispersal distance has a weak effect in the range we used (relative variation of 0.1).    

The patch size distributions have been used to detect the closeness of the critical point when the spatial patterns are non periodic or irregular as in our case [@Kefi2014]. In our simulations the most frequent best model ---with lower $AIC_c$---was the power law with exponential cutoff (70%), the pure power law was found best in 8% of the cases and the exponential model never was found to be the best model (Appendix Table 3). The rest of the cases (22%) correspond to simulations with $\rho$ greater than $\rho_c$ where one big spanning patch exist and there are few other patches of the same species, so a distribution model can not be fitted following the criteria we stated in methods. Thus we adopted as a possible indicators of the phase transition the parameters of the power law with exponential cutoff model: $\alpha$ the power exponent and $\lambda$ the exponential decay rate. We fitted quantile regressions using three quantiles: 0.25, 0.50 and 0.75. 

For the biggest patch and the spanning species $\alpha$ has an increasing tendency but slopes are non-significative at 5% level in near 60% of the cases (Appendix Table 4 and appendix Figure S3), The $\lambda$'s slopes are also non-significant in nearly 60% of cases and do not have consistent patterns for all the cases: a decreasing pattern for logseries communities; for uniform communities most abundant species have negative slopes and spanning species have positive slopes (Appendix Figure S4). The most clear and consistent patterns are observed for the patches of other species clumped, which have for $\lambda$ only 1 case was non-significant (8%) but for $\alpha$ also had 58% of cases non-significant (Appendix table 4). Before the critical point the $\lambda$ have a negative slope and after the critical point have a positive slope, we also observed that the median of $\lambda$ reaches a minimum right after the critical point ($\rho_c$ between 0.0011-0.0013). Thus the slope of $\lambda$ could be used as an indicator of the critical point. If the community is approaching the critical point the slope will be negative and if it is past the critical point the slope will be positive.             

For BCI data we found that there is no spanning patch, the relatively small scale we chose for discretization produced small patches so the biggest patch have an average size of 0.006% of the lattice. The best models were the power law with exponential cutoff for the biggest patch species, and the power law for the other species, but in this last group the power law with exponential cutoff is also a plausible model because the differences in $AIC_c$ are around 2, and the fitted power exponents are the same (up to two decimals). Thus we regressed the parameter $\lambda$ against year to detect any tendency that would indicate an approaching or a moving away from a critical point. The slopes we obtained were all non-significant (Appendix table 5) thus there is no indication that the BCI is near a critical point.


# Discussion

We described for the first time a spatial phase transition between neutral and niche ecological communities. The power laws of patch size distributions observed in this model are not only produced at the critical point but are present over the whole range of the control parameter $\rho$. There are some ecological models that display this kind of behavior and it has been termed robust criticality, because of the permanence of scaling laws [@Pascual2005a]. These previous models all included some kind of disturbances or stress, and with the increase in disturbance levels an increase in the exponential decay ($\lambda$) of patch sizes is observed. This increase can be the result of a switch from a power law to a power law with exponential cutoff model [@Kefi2011], or by an increase of $\lambda$ in the power law with exponential cutoff model [@Weerman2012]. In our model model, the competition intensity $\rho$ can play the same role as stress; a very small degree of competition produce a critical transition from a neutral phase to a niche phase, and the most competitive species invades a great portion of the landscape. 

The sequence of an increasing $\lambda$ when the critical point is approached is not observed in our model but a decrease of it when the system goes towards the critical point, and then an increase. This coincides with theoretical predictions from percolation theory [@Stauffer1994], at the critical point the exponential decay in the patch distribution vanishes and the patch distribution becomes a pure power-law. We did not observe the pure power-law because the size of the simulations is finite, but as $\lambda$ becomes very small the power-law and power-law with exponential cutoff become almost identical. 

When the increase of $\lambda$ starts we already have a biodiversity collapse, thus the pattern that can be used to  detect the closeness to the collapse is the decrease in $\lambda$ observed for the patches of all species excluding the one with the biggest patch. The existence of a patch of one dominant species that covers nearly 30% of the area can also suggest that the system is near the critical point. This patch that extends from side to side of the system ---also called the spanning cluster--- has a variable size depending on the size of the system (from 28% to 38%). Thus it can not be used alone as an early warning, the size of the biggest mono-specific patch should be used in conjunction with the decrease of $\lambda$, if the size of the biggest patch is around 10% the system might not be close to the critical point, but if its size is around 30% or more the probability that the system is near a critical transition is greater.  

We calculated $\lambda$ for the patch distribution of the Barro Colorado Island in Panama (BCI), the method could be applied because the power-law with exponential cutoff is a plausible model for the patch distributions. We did not find any tendency with time in $\lambda$ and the biggest mono-specific patches are very small, although we may be underestimating these sizes. There are contradicting results about the BCI regarding if it is in a steady-state, some point out BCI as been in non-equilibrium state [@Fort2013a] and another suggests that it is in a steady state [@Azaele2006]. We found that $\lambda$ is not changing with time, this is compatible with a steady-state of the forest, moreover the forest seems not to be close ---until now---to a critical point. 

A commonly used pattern to characterize ecological communities is the species abundance distribution, that we used in the form of rank abundance diagrams (RAD). It was demonstrated that neutral and niche mechanisms could produce the same RAD [@Volkov2005;@Chisholm2010], so it might not be used to determine the proximity to the critical point.  We found that there is a change in the RAD when the critical point is approached but these changes are small and will probably go undetected [@Saravia2015a]. The shape of the RAD is highly dependent on the metacommunity, which is difficult to estimate as a baseline, thus there is no RAD characteristic of a community near the critical point. The species richness and Shannon diversity of the community are both resumed versions of the species abundance distribution. Richness keeps fluctuating around a more or less constant value when the community goes through the critical transition. Shannon diversity depend on the metacommunity and on the existence of trade-off: in some cases it increases before the critical point and in other cases starts to decrease. Thus these two indices can be misleading indicators of the proximity of a critical transition.

In any case the use of several indicators is recommended [@Kefi2014], the indicators developed in this study have the advantage of combining the spatial and temporal information thus they should be more robust than indicators based in only one kind of information [@Martin2015]. Other kinds of early warnings signals developed for spatial systems like spatial variance or autocorrelation should be adapted for multispecific communities and a detailed study comparing all of them should be done. 

Percolation transitions like the one observed in this model are second order or continuous critical transitions. This means that unless the system becomes degraded and changes its internal dynamics, these transitions are reversible. Much of the ecological literature was dedicated to study of other kinds of transitions: first order or discontinuous transitions that produce hysteresis ---also called regime shifts---and rely on the understanding of deterministic equations [@Sole2006]. These kinds of transitions are practically irreversible but in real ecosystems the presence of noise and spatial heterogeneities can convert irreversible transitions into second order transitions [@Martin2015], this enhances the importance of  second order phase transitions like the ones detected here.

A recently published model related the savanna-forest transition to a phase transition between persistent species in a neutral model without including any niche effect [@Abades2014]. The spanning cluster that appears at the critical point is theoretically infinite [@Stauffer1994; @Sornette2013]. But percolation is studied in finite systems as a consequence, in small lattices the spanning cluster has a positive probability to appear. In our model, we observed the apparition of a spanning cluster in the neutral phase only at the smallest lattice sizes (100-150 sites), but a spanning cluster never appears at greater sizes. Thus we did not observe a critical transition for neutral communities, this is in contrast with Abades et al. [-@Abades2014] who reported a critical phase transition for a neutral model using a lattice with sides from 10 to 100. In both cases the same order parameter was used ---the probability of a spanning cluster--- but we used a different control parameter. They used the proportion of sites with a stable population of a given species as a control parameter. It seems that their results are related to static percolation, not to the neutral model. In static percolation occupied sites are located at random in a lattice and there is no time dependence or change, when the proportion of occupied sites reach a threshold percolation is observed. This is analogous to Abades et al. procedure, so they obtained percolation because they varied the proportion of occupied sites (and the populations within these sites were stable), not as a result of the use of a neutral model.   

Using an spatially implicit model Fisher & Metha  [-@Fisher2014] described a phase transition between a neutral and niche communities. They used a stochastic Lokta-Volterra model for niche communities where neutral dynamics was added as Gaussian noise. Their mechanism is similar to ours but generalized to different kinds of interactions. Their model predicts that under stress a community will suffer a biodiversity collapse produced by a shift towards neutrality. This means that disturbed less diverse communities should have neutral dynamics. This prediction is contrary to most of the models and experimental data that suggest that niche dynamics dominate low-diversity communities while neutral dynamics will be more common in high diversity communities  [@Chisholm2011]. Our results are in accordance with this last prediction: the critical point $\rho_c$ is lower for low diversity communities. This implies that they are more sensitive to changes in environmental conditions, a small change can make them to shift to a niche phase. 

The results our model and similar works in spatially implicit models implies that most ecosystems will exhibit patterns of diversity that are either strongly niche-structured or indistinguishable from neutral [@Chisholm2011; @Fisher2014]. Anyway there is another option, several field studies have demonstrated that weak interactions are a general phenomenon for species rich communities [@Martorell2014,@Volkov2009] which is also observed for natural food webs [@Wootton2005b], so it is possible that these communities live near the critical point between neutrality and niche. This suggests the existence of a mechanism similar to critical self organization as hypothesized by Solé et al. [-@Sole2002a] called self-organized instability. In this general mechanism the immigration of new species increase diversity and connectivity, we argue that it also  might increase interaction strength; this will happen until the critical point is reached and then diversity diminishes. Thus, only communities with weak interactions can maintain high diversity in the long term. The mechanisms included in this model are generic, the only differences between species are their competitive ability and their frequency in the metacommunity. The habitat is homogeneous so niche partition mechanisms are not included but the final effect could be the same at the end: the lowering of the intensity of interactions. 

Habitat fragmentation produce more isolated communities [@Haddad2015], where less effective space is available to species thus disregarding the effect of the spatial pattern of habitat destruction this is equivalent to a community composed of less sites. Then it is probable than fragmentation shifts the critical point to lower values making the communities more sensitive to environmental changes. At the same time these communities would have a stronger niche effect and a high probability of biodiversity collapse. As we have previously mentioned, the distribution of habitable and non-habitable sites produced by fragmentation could result in percolation and critical phenomena. The interplay between these two critical transitions can be more complex than was previously thought [@Oborny2007]. Thus the combination of these two critical phenomena should be thoroughly studied, also the extension to different kinds of interactions including food webs, mutualistic communities and intransitive competition [@Soliveres2015] is a fundamental next step, but great care should be given to the method of simulating the interaction coefficients to recreate realistic communities [@Rohr2014].

The novelty of this critical transition is that it occurs before that produced by habitat loss,  deforestation, land use changes, increased grazing, fragmentation, etc., and it only needs a change in the environmental conditions that changes the strength of the interaction between species. This also could be produced if habitat connectivity and species that previously did not interact have the possibility to compete, in the same line an invading species could produce the same effect and trigger a phase transition in a formerly neutral community. A great portion of biosphere's ecosystems are under the pressures produced by human-induced activities, but human activities also produce global-scale forcings ---like climate change---that can reach relatively pristine ecosystems although they are not under a direct influence of human activities [@Barnosky2012]. This kind of changes can be represented by the phase transition described here before the ecosystem is under a direct degradation, and the detection of this kind of transition could be used as a signal to detect a global state shift in the biosphere.

# Acknowledgments

We are grateful to the National University of General Sarmiento for financial support, and to Graeme Ruxton for their English revision. This work was partially supported by a grant from CONICET (PIO 144-20140100035-CO). We thank Jordi Bascompte and Juan Bonachela for their comments and discussions on earlier versions of the manuscript.
The BCI forest dynamics research project was made possible by National Science Foundation grants to Stephen P. Hubbell: DEB-0640386, DEB-0425651, DEB-0346488, DEB-0129874, DEB-00753102, DEB-9909347, DEB-9615226, DEB- 9615226, DEB-9405933, DEB-9221033, DEB-9100058, DEB- 8906869, DEB-8605042, DEB-8206992, DEB-7922197, support from the Center for Tropical Forest Science, the Smithsonian Tropical Research Institute, the John D. and Catherine T. MacArthur Foundation, the Mellon Foundation, the Celera Foundation, and numerous private individuals, and through the hard work of over 100 people from 10 countries over the past two decades. The plot project is part of the Center for Tropical Forest Science, a global network of large-scale demographic tree plots.


# References
